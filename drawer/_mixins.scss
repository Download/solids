//
// Copyright 2018 Stijn de Witt. Some rights reserved.
// Licensed under the MIT Open Source license. 
// https://opensource.org/licenses/MIT
// See LICENSE for details.
//
// Based on code copyright 2018 Google Inc. All Rights Reserved.
// Licensed under the Apache License, Version 2.0.
// http://www.apache.org/licenses/LICENSE-2.0
// See LICENSE-MDC for details.
// 
// Unless required by applicable law or agreed to in writing, software
// distributed under these licenses is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the licenses for the specific language governing permissions and
// limitations under these licenses.
// 

@import "../animation/functions";
@import "../animation/variables";
@import "../theme/mixins";
@import "../theme/variables";
@import "../typography/mixins";


@mixin mdc-drawer-fill-color($color) {
  @include mdc-theme-prop(background-color, $color);
}


@mixin mdc-drawer-ink-color($color) {
  @include mdc-theme-prop(color, $color);
}


@mixin mdc-drawer-scrim-color($color, $opacity) {
  &::before {
    background-color: rgba(mdc-theme-prop-value($color), $opacity);
  }
}


@mixin mdc-drawer-fill-color-accessible($color) {
  @include mdc-drawer-ink-color(mdc-theme-accessible-ink-color($color));
  @include mdc-drawer-fill-color($color);
}


@mixin solid_drawer_base() {
  @include mdc-drawer-ink-color($drawer-ink-color);
  @include mdc-drawer-fill-color($drawer-fill-color);
  @include typography(subtitle1);  

  float: left;
  @include mdc-rtl {
    float: right;
  }
  overflow: hidden;

  .item {
    @include typography(subtitle2);

    position: relative;
    outline: none;
    color: inherit;
    text-decoration: none;
  }

  .graphic {
    color: rgba(0, 0, 0, .54);
  }
  
  >div {
    >div {
      >nav {
        width: $drawer-width;
        box-sizing: border-box;
        width: $drawer-width;
        display: inline-flex;
        flex-direction: column;
        flex: 0 0 auto;
        vertical-align: top;

        >header {
          display: none;
        }
      }

      &::before {
        position: absolute;
        content: '';
        top: 0;
        bottom: 0;
        height: 100%;
        background: yellow; 
        
      }
    }

    &::after {
      content:'';
      display: block;
      height: 1px;
    }
  }

  >label {
    position: absolute;
    // width: 
    top: -($appbar-row-height + 16px);
    padding: $appbar-section-vertical-padding $appbar-section-horizontal-padding;
    cursor: pointer;
    z-index: 1;
    user-select: none;

    @include mdc-rtl-reflexive-position(left, 0);
    // left: 0;
    // @include mdc-rtl {
    //   right: 0;
    // }
      
    >a {
      @include appbar-icon_;
      @include appbar-fill-color-accessible(primary);
    }
  }

  >input[type=checkbox] {
    display:none;
    &:checked {
      // &~ label {
      //   z-index: 2;
      // }
      &~ div >div,
      &~ div >div::before {
        width: $drawer-width;
      }
    }
  }

  // right-hand side drawer (in ltr)
  &.end {
    float: right;
    @include mdc-rtl {
      float: left;
    }
    >label {
//      z-index: 0;
      right: 0;
      left: initial;
      @include mdc-rtl {
        left: 0;
        right: initial;
      }
    }
  }

  &.fixed {
    z-index: 1;
  }
}


@mixin solid_drawer_permanent() {
  display: inline-flex;

  >div {
    @include mdc-rtl-reflexive-box(border, right, 1px solid #e4e4e4);
    overflow: hidden;
  }

  &.floating {
    >div {
      @include mdc-rtl-reflexive-box(border, right, none);
      background: none;
    }
  }

  // right-hand side drawer (in ltr)
  &.end {
    >div {
      @include mdc-rtl-reflexive-box(border, left, 1px solid #e4e4e4);
    }

    &.floating {
      >div {
        @include mdc-rtl-reflexive-box(border, left, none);
      }
    }
  }
}


@mixin solid_drawer_persistent() {
  &.fixed {
    position: sticky;
    top: 16px;
/*
    >label {
      top: -($appbar-row-height + 16px);
    }
*/
  }

  >div >div,
  >div >div::before {
    width: 0;
    will-change: width;
    transition: width 250ms;
  }

  >div >div >nav {
    will-change: transform;
    transform: translateX(-$drawer-width);
    @include mdc-rtl {
      transform: translateX($drawer-width);
    }
    transition: transform $drawer-transition-duration + 10ms; // transition a bit slower, to prevent flicker on Firefox.
  }
  
  >input[type=checkbox] {
    &:checked ~ div {
      overflow: hidden;
    }

    &:checked ~ div >div::before {
      
      // @include mdc-rtl-reflexive-box(border, right, 1px solid #e4e4e4);
      // @include mdc-rtl-reflexive-position(left, 0);
      //				@include mdc-slideable-drawer;
//      width: $drawer-width;
//      height: 100%;
//      box-sizing: border-box;
//      overflow: hidden;
    }

    &:checked ~ div >div {
      >nav {
        transform: translateX(0);
      }
    }

    &:checked ~ div >div::before {
      @include mdc-rtl-reflexive-box(border, right, 1px solid #e4e4e4);
    }    
  }

  &.floating {
    >input[type=checkbox] {
      &:checked ~ div >div {
        @include mdc-rtl-reflexive-box(border, right, none);
      }
    }
  }

  // right-hand side drawer (in ltr)
  &.end {
    >div >div {
      transition: width 250ms;
      >nav {
        transform: translateX($drawer-width);
        @include mdc-rtl {
          transform: translateX(-$drawer-width);
        }
      }
    }
    >input[type=checkbox] {
      &:checked ~ div >div {
        @include mdc-rtl-reflexive-box(border, left, 1px solid #e4e4e4);
      }
    }

    &.floating {
      >input[type=checkbox] {
        &:checked ~ div >div {
          @include mdc-rtl-reflexive-box(border, left, none);
        }
      }
    }
  }
}


@mixin solid_drawer_temporary() {
  position: absolute;

  >label {
    background: rgba(0,0,0,0);
    will-change: background;
    transition: background $drawer-transition-duration - 100ms; // transition a bit faster, to prevent 'afterglow' of label in button form
  }

  >div {
    width: $drawer-width;
    position: fixed;
    top: 0;
    bottom: 0;
    @include mdc-rtl-reflexive-position(left, 0);
    @include mdc-drawer-fill-color($drawer-fill-color);
    @include mdc-drawer-ink-color($drawer-ink-color);
    height: 100vh;
    margin: 0;
    padding: 0;
    overflow: hidden;
    z-index: 3;
    will-change: transform;
    transition: transform 200ms;
    transform: translateX(-$drawer-width);
    @include mdc-rtl {
      transform: translateX($drawer-width);
    }

    >div {
      // // make this div a scroll-blocking layer
      height: 100vh;
      overflow-x: hidden;
      overflow-y: auto; // allow scroll
      width: $drawer-width + 30px; // hide scrollbar
      // // make sure there is tall content to force a scrollbar
      &::after {
        content: '';
        display: block;
        height: 10000px;
      }
      
      >nav {
        position: sticky; // stick to top so it does not scroll
        top: 0;
        >header {
          display: block;
          position: relative;
          &:before {
            content: '';
            display: block;
            padding-top: 56.25%;
          }
          >div {
            display: flex;
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            align-items: flex-end;
            box-sizing: border-box;
            padding: 16px;
            background-color: $drawer-header-fill-color;
            color: $drawer-header-ink-color;
          }
        }
      }
    }
  }

  &.end {
    @include mdc-rtl-reflexive-position(right, 0);

    >input[type=checkbox]:checked ~ label {
//      z-index: 2;
    }
    >div {
      @include mdc-rtl-reflexive-position(right, 0);
      @include mdc-rtl-reflexive-box(border, left, 1px solid #e4e4e4);
      transform: translateX($drawer-width);
      @include mdc-rtl {
        transform: translateX(-$drawer-width);
      }
    }
  }

  >input[type=checkbox] {
    &:checked {
      &~ label {
        position: fixed;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        padding: 0;
        background: rgba(mdc-theme-prop-value($drawer-scrim-color), $drawer-scrim-opacity);
        overflow: hidden;
        cursor: default;
        >a {
          display: block;
          width: calc(100% + 100px);
          height: 100%;
          overflow-x: hidden;
          overflow-y: auto;
          background: transparent;
          cursor: default;
          margin-left: -50px;
          padding: 0;
          // pointer-events: none;
          &:before {
            display: none;
          }
          &:after {
            content: '';
            display: block;
            position: initial;
            height: 10000px;
            width: 10px;
            background: red;
          }
        }
      }
      &~ div >div {
              //				@include mdc-slideable-drawer;
        transform: translateX(0);
        box-shadow: -10px 0px 100px rgba(0, 0, 0, 0.35);
        @include mdc-rtl {
          box-shadow: 10px 0px 100px rgba(0, 0, 0, 0.35);
        }
      }
    }
  }
/*
  .drawer_button_temporary {
      top: -($appbar-row-height + 16px);
  }
*/
}


@mixin solid_drawer_base_appbar_styles() {
  .solids .appbar.dense {
    &~ .drawer {
      >label {
        top: -($appbar-dense-row-height + 16px);
        padding: 0 $appbar-section-horizontal-padding;
      }
    }
  
    &.prominent {
      &:not(.fixed) { 
        &~ .drawer {
          >label {
            top: -($appbar-dense-row-height*2 + 16px);
          }
        }
      }
      &.fixed {
        &~ .drawer {
          &.fixed {
            top: $appbar-dense-row-height*2 + 16px;
          }
        }
      }
    }
  }

  .solids .appbar.prominent {
    &:not(.fixed) { 
      &~ .drawer {
        >label {
          top: -($appbar-prominent-row-height + 16px);
        }
      }
    }
    &.fixed {
      &~ .drawer {
        &.fixed {
          top: $appbar-prominent-row-height + 16px;
        }
      }
    }
  }

  // .appbar_prominent {
  //   &~ .solid_drawer {
  //     >label {
  //       top: -($appbar-prominent-row-height + 16px);
  //     }
  //     // &.drawer_fixed {
  //     //   // top: $appbar-prominent-row-height + 16px;
  //     //   // >label {
  //     //   //   top: -($appbar-prominent-row-height + 16px);
  //     //   // }
  //     // }
  //   }
  //   &.appbar_shrink {
  //     &~ .solid_drawer {
  //       &.drawer_fixed {
  //         top: $appbar-row-height + 16px;
  //       }
  //     }
  //   }
  // }

  .solids .appbar.fixed {
    &~ .drawer {
      &.fixed {
        top: $appbar-row-height + 16px;
      }
      >label {
        position: fixed;
        top: 0;
      }
    }
    /*
    &.appbar_prominent ~ .solid_drawer {
      &.drawer_persistent, 
      &.drawer_temporary,
      &.drawer_responsive {
        .drawer_button_persistent,
        .drawer_button_temporary {
          >a {
            top: -($appbar-prominent-row-height + 16px);
          }
        }
      }
    }
    */
  }
}


